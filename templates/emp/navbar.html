{% comment %} {% if messages %}
  {% for message in messages %}
    <div class="alert alert-success alert-dismissible fade show mt-4" role="alert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            <span class="sr-only">Close</span>
        </button>
        {{ message }}
    </div>
  {% endfor %}
{% endif %}

<div class="col-md-10 offset-md-3">

  <nav class="navbar navbar-expand-lg" style="background-color: white">
    <div class="container-fluid">
      <a class="navbar-brand" style=color:blue;>Farmer Management System</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
              aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="/emp/add-emp/" style=color:blue;>Add Farmer</a>
          </li>
          <li><a class="nav-link" href="/emp/home/" style=color:blue;>View Table</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div style="margin-right: 60px; ">
    <img src="https://gifdb.com/images/high/farmer-planting-under-the-rain-mhmnqfzyhnjwmj5t.gif" alt="" width="90%" height="90%">
  </div>

  <div style="margin-top: 20px;">
    <form id="cropForm">
      {% csrf_token %}
      <label for="cropName">Enter Crop Name:</label>
      <input type="text" id="cropName" name="cropName">
      <button type="submit">Get Crop Data</button>
    </form>
    <div id="cropData"></div>
  </div>
    <script>
      const form = document.getElementById('cropForm');
      const cropData = document.getElementById('cropData');
      
      form.addEventListener('submit', async (e) => {
          e.preventDefault();
          const cropName = document.getElementById('cropName').value;
      
          try {
              const response = await fetch('https://1vk8d5k11e.execute-api.eu-west-1.amazonaws.com/default/x23109831_cropproj', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({ crop: cropName })
              });
      
              if (response.ok) {
                  const data = await response.json();
                  cropData.innerHTML = JSON.stringify(data, null, 2);
              } else {
                  throw new Error('Error fetching crop data');
              }
          } catch (error) {
              cropData.innerHTML = `Error fetching crop data: ${error.message}`;
          }
      });
  </script> {% endcomment %}


{% if messages %}
  {% for message in messages %}
    <div class="alert alert-success alert-dismissible fade show mt-4" role="alert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            <span class="sr-only">Close</span>
        </button>
        {{ message }}
    </div>
  {% endfor %}
{% endif %}

<div class="col-md-10 offset-md-3">

  <nav class="navbar navbar-expand-lg" style="background-color: white">
    <div class="container-fluid">
      <a class="navbar-brand" style=color:blue;>Farmer Management System</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
              aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="/emp/add-emp/" style=color:blue;>Add Farmer</a>
          </li>
          <li><a class="nav-link" href="/emp/home/" style=color:blue;>View Table</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div style="margin-right: 60px; ">
    <img src="https://gifdb.com/images/high/farmer-planting-under-the-rain-mhmnqfzyhnjwmj5t.gif" alt="" width="90%" height="90%">
  </div>

  <div style="margin-top: 20px;">
    <form id="cropForm">
      {% csrf_token %}
      <label for="cropName">Enter Crop Name:</label>
      <input type="text" id="cropName" name="cropName">
      <button type="submit">Get Crop Data</button>
    </form>
    <div id="cropData"></div>
  </div>

  <div style="margin-top: 20px;">
    <p style="font-size: 16px; color: #333;">Click below to explore new added features:</p>
    <button onclick="window.location.href='/random-fact'" style="background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">Random Facts & Weather</button>
</div>


<script>
  const form = document.getElementById('cropForm');
  const cropData = document.getElementById('cropData');
  
  form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const cropName = document.getElementById('cropName').value;
  
      try {
          const response = await fetch('https://1vk8d5k11e.execute-api.eu-west-1.amazonaws.com/default/x23109831_cropproj', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json'
              },
              body: JSON.stringify({ crop: cropName })
          });
  
          if (response.ok) {
              const data = await response.json();
              cropData.innerHTML = JSON.stringify(data, null, 2);
          } else {
              throw new Error('Error fetching crop data');
          }
      } catch (error) {
          cropData.innerHTML = `Error fetching crop data: ${error.message}`;
      }
  });

  function getWeather() {
      window.location.href = '/weather/today'; // Redirect to the weather endpoint
  }
</script>
